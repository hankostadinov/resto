<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ресто (EUR или BGN) — курс 1.95583</title>
  <style>
    :root{
      --bg:#f6f8fc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --border: rgba(15,23,42,.14);
      --shadow: 0 18px 40px rgba(2,6,23,.12);
      --radius: 16px;
      --warn:#b91c1c;

      --blue:#2563eb;
      --green:#16a34a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 15% -10%, rgba(37,99,235,.14), transparent 60%),
        radial-gradient(800px 520px at 95% 10%, rgba(22,163,74,.12), transparent 55%),
        var(--bg);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 22px;
    }
    .card{
      width: min(980px, 100%);
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    h1{font-size: 20px; margin:0 0 10px}
    .hint{color: var(--muted); margin:0 0 14px; font-size:14px; line-height:1.35}

    .grid{display:grid; gap:12px}
    label{font-size: 13px; color: var(--muted); display:block; margin-bottom:8px}

    .inlineField{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    input{
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      outline: none;
      font-size: 16px;
      font-variant-numeric: tabular-nums;
      height: 44px;
      width: 240px;
      max-width: 100%;
    }
    input:focus{
      border-color: rgba(37,99,235,.55);
      box-shadow: 0 0 0 4px rgba(37,99,235,.12);
    }

    button.action{
      cursor:pointer;
      border:1px solid var(--border);
      background: #fff;
      color: var(--text);
      padding: 11px 14px;
      border-radius: 12px;
      font-weight: 900;
      transition: border-color .12s ease, box-shadow .12s ease, transform .08s ease, background .12s ease, color .12s ease;
      white-space:nowrap;
      height: 44px;
    }
    button.action:hover{
      border-color: rgba(37,99,235,.35);
      box-shadow: 0 10px 25px rgba(2,6,23,.08);
      transform: translateY(-1px);
    }
    button.action:active{transform: translateY(0px)}
    .ghost{background: rgba(2,6,23,.03) !important}
    .primary{
      border-color: transparent !important;
      background: linear-gradient(135deg, rgba(37,99,235,.95), rgba(22,163,74,.85)) !important;
      color:#fff !important;
    }

    /* Toggle base */
    .toggle{
      display:inline-flex;
      border:1px solid var(--border);
      border-radius: 12px;
      overflow:hidden;
      height:44px;
      background: rgba(2,6,23,.03);
    }
    .toggle button{
      border:0;
      background: transparent;
      padding: 0 14px;
      cursor:pointer;
      font-weight:900;
      color: var(--muted);
      height:44px;
      transition: background .12s ease, color .12s ease, box-shadow .12s ease;
    }
    .toggle button.active{
      color: #fff;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.35);
    }

    /* Bill currency toggle color states */
    #billBGNBtn.active{ background: var(--green); }
    #billEURBtn.active{ background: var(--blue); }

    /* Switch (checkbox) */
    .switch{
      display:flex;
      align-items:center;
      gap:10px;
      user-select:none;
    }
    .switch input{
      width:auto;
      height:auto;
      margin:0;
      accent-color: var(--blue);
      transform: scale(1.15);
    }
    .switch span{
      font-size: 13px;
      color: var(--muted);
      font-weight: 900;
      white-space:nowrap;
    }

    /* Надписът да е до суича (не в дясно на картата) */
    .billTop{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      width:100%;
    }
    .billStatus{
      text-align:left;
      font-size: 13px;
      color: var(--muted);
      font-weight: 900;
      white-space:nowrap;
    }

    .pickedRow{
      display:flex;
      align-items:stretch;
      gap:10px;
      margin-top: 10px;
      flex-wrap:wrap;
    }
    .picked{
      flex: 1 1 420px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: rgba(2,6,23,.03);
      padding: 10px 12px;
      display:flex;
      gap:10px;
      align-items:baseline;
      min-height:44px;
    }
    .picked .title{
      font-size: 13px;
      color: var(--muted);
      font-weight: 800;
      white-space:nowrap;
    }
    .picked .list{
      font-size: 14px;
      color: var(--text);
      font-variant-numeric: tabular-nums;
      overflow-wrap:anywhere;
    }

    .banknotes{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:10px;
      margin-top: 10px;
    }
    .bn{
      border: 1px solid var(--border);
      border-radius: 14px;
      background: #fff;
      padding: 10px;
      cursor: pointer;
      display:grid;
      gap:8px;
      align-content:start;
      transition: transform .08s ease, border-color .12s ease, box-shadow .12s ease;
      user-select:none;
    }
    .bn:hover{
      border-color: rgba(37,99,235,.35);
      box-shadow: 0 10px 25px rgba(2,6,23,.08);
      transform: translateY(-1px);
    }
    .bn:active{transform: translateY(0px) scale(.99)}
    .bn img{
      width:100%;
      height:64px;
      object-fit:cover;
      border-radius: 10px;
      border: 1px solid rgba(15,23,42,.10);
      background: linear-gradient(135deg, rgba(37,99,235,.10), rgba(22,163,74,.08));
    }
    .bn .cap{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-weight:900;
      font-variant-numeric: tabular-nums;
      font-size: 14px;
    }
    .bn .cap span{color: var(--muted); font-weight:800}

    .banknotesSection[hidden]{ display:none !important; }

    .result{
      margin-top: 12px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(37,99,235,.06);
      display:grid;
      gap:12px;
    }
    .resultGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:start;
    }
    .kpi{
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.6);
      border-radius: 12px;
      padding: 10px 12px;
    }
    .kpi .small{color: var(--muted); font-size: 13px}
    .kpi .big{
      font-size: 34px;
      font-weight: 900;
      letter-spacing: -.5px;
      margin: 2px 0 0;
      line-height: 1.1;
      font-variant-numeric: tabular-nums;
    }

    #eur.big{ color: var(--blue); }
    #bgn.big{ color: var(--green); font-size: 26px; }

    .warn{color: var(--warn)}
    #info{color: var(--muted); font-size: 13px}

    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}

    @media (max-width: 780px){
      .resultGrid{grid-template-columns: 1fr;}
    }
    @media (max-width: 560px){
      .banknotes{grid-template-columns: repeat(2, minmax(0, 1fr));}
      input{width:100%;}
      .inlineField{width:100%;}
      button.action{width:100%;}
      .toggle{width:100%;}
      .toggle button{flex:1}
      .billRow{width:100%}
      .billTop{width:100%}
      .billStatus{width:100%}
    }
  </style>
</head>
<body>
  <main class="card">
    <h1>Ресто (EUR или BGN)</h1>
    <p class="hint">
      При връщане в EUR сумата се закръгля към най-близък евроцент (0.01 EUR).
      Курс: <b>1.95583</b>.
    </p>

    <div class="grid">
      <!-- Сметка -->
      <div>
        <label>Обща сметка на клиента</label>

        <div class="billBlock">
          <div class="billTop">
            <div class="toggle" role="group" aria-label="Валута на сметката">
              <button type="button" id="billEURBtn" class="active">EUR</button>
              <button type="button" id="billBGNBtn">BGN</button>
            </div>
            <div class="billStatus" id="billHint">Сметката е в евро (EUR).</div>
          </div>

          <div class="billRow">
            <input id="bill" inputmode="decimal" placeholder="напр. 23.40" />
            <button class="action ghost" id="clearBillBtn" type="button">Изчисти сметката</button>
          </div>
        </div>
      </div>

      <!-- Дадени: BGN + EUR (микс) -->
      <div>
        <label>Дадени пари от клиента</label>
        <div class="inlineField">
          <input id="paid" inputmode="decimal" placeholder="лв (напр. 50.00)" />
          <input id="paidEur" inputmode="decimal" placeholder="EUR (напр. 10.00)" />
          <button class="action ghost" id="clearPaidBtn" type="button">Изчисти дадено</button>

          <label class="switch" style="margin-left:auto;">
            <input type="checkbox" id="showBanknotesSwitch" />
            <span>Покажи банкнотите</span>
          </label>
        </div>

        <div class="banknotesSection" id="banknotesSection" hidden>
          <div class="pickedRow" aria-live="polite">
            <div class="picked">
              <div class="title">Натиснати:</div>
              <div class="list" id="pickedList">—</div>
            </div>
            <button class="action ghost" id="undoBtn" type="button">← Махни последната</button>
          </div>

          <div class="banknotes" id="banknotes">
            <!-- Смени src с твоите картинки -->
            <button class="bn" type="button" data-value-st="50" data-label="0.50">
              <img src="images/050lv.jpg" alt="50 ст" />
              <div class="cap"><strong>0.50</strong><span>лв</span></div>
            </button>
            <button class="bn" type="button" data-value-st="100" data-label="1">
              <img src="images/1lv.jpg" alt="1 лв" />
              <div class="cap"><strong>1</strong><span>лв</span></div>
            </button>
            <button class="bn" type="button" data-value-st="200" data-label="2">
              <img src="images/2lv.jpg" alt="2 лв" />
              <div class="cap"><strong>2</strong><span>лв</span></div>
            </button>
            <button class="bn" type="button" data-value-st="500" data-label="5">
              <img src="images/5lv.jpg" alt="5 лв" />
              <div class="cap"><strong>5</strong><span>лв</span></div>
            </button>
            <button class="bn" type="button" data-value-st="1000" data-label="10">
              <img src="images/10lv.jpg" alt="10 лв" />
              <div class="cap"><strong>10</strong><span>лв</span></div>
            </button>
            <button class="bn" type="button" data-value-st="2000" data-label="20">
              <img src="images/20lv.jpg" alt="20 лв" />
              <div class="cap"><strong>20</strong><span>лв</span></div>
            </button>
            <button class="bn" type="button" data-value-st="5000" data-label="50">
              <img src="images/50lv.jpg" alt="50 лв" />
              <div class="cap"><strong>50</strong><span>лв</span></div>
            </button>
            <button class="bn" type="button" data-value-st="10000" data-label="100">
              <img src="images/100lv.jpg" alt="100 лв" />
              <div class="cap"><strong>100</strong><span>лв</span></div>
            </button>
          </div>
        </div>
      </div>

      <!-- РЕСТО -->
      <div class="result" aria-live="polite">
        <div class="resultGrid">
          <div class="kpi">
            <div class="small">Ресто за връщане (EUR)</div>
            <div id="eur" class="big">0.00</div>
          </div>
          <div class="kpi">
            <div class="small">Ресто за връщане (BGN)</div>
            <div id="bgn" class="big">0.00</div>
          </div>
        </div>

        <div id="info"></div>
      </div>

      <div class="btns">
        <button class="action primary" id="calcBtn" type="button">Изчисли</button>
        <button class="action" id="clearAllBtn" type="button">Изчисти всичко</button>
      </div>
    </div>
  </main>

  <script>
    // 1 EUR = 1.95583 BGN
    const RATE = 1.95583;

    const billEl = document.getElementById('bill');

    const paidEl = document.getElementById('paid');       // BGN
    const paidEurEl = document.getElementById('paidEur'); // EUR (NEW)

    const eurEl = document.getElementById('eur');
    const bgnEl = document.getElementById('bgn');
    const infoEl = document.getElementById('info');

    const banknotesSection = document.getElementById('banknotesSection');
    const showBanknotesSwitch = document.getElementById('showBanknotesSwitch');
    const banknotesWrap = document.getElementById('banknotes');
    const pickedListEl = document.getElementById('pickedList');

    const undoBtn = document.getElementById('undoBtn');
    const clearPaidBtn = document.getElementById('clearPaidBtn');
    const clearBillBtn = document.getElementById('clearBillBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const calcBtn = document.getElementById('calcBtn');

    const billEURBtn = document.getElementById('billEURBtn');
    const billBGNBtn = document.getElementById('billBGNBtn');
    const billHint = document.getElementById('billHint');

    // По подразбиране: сметка в EUR
    let billCurrency = "EUR";

    const picked = []; // {st, label} (само за BGN банкноти)

    function parseNumber(value){
      if (typeof value !== 'string') return NaN;
      const v = value.trim().replace(',', '.');
      return v === '' ? NaN : Number(v);
    }

    function clearWarn(){ infoEl.classList.remove('warn'); }
    function setWarn(text){
      infoEl.textContent = text;
      infoEl.classList.add('warn');
    }

    function pickedSumSt(){
      return picked.reduce((s, x) => s + x.st, 0);
    }

    function updatePickedUIAndPaid(){
      pickedListEl.textContent = picked.length ? picked.map(x => x.label).join(", ") : "—";
      // банкнотите пълнят САМО лева
      paidEl.value = (pickedSumSt() / 100).toFixed(2);
    }

    function billToBGN(billValue){
      if (!Number.isFinite(billValue)) return NaN;
      return billCurrency === "BGN" ? billValue : billValue * RATE;
    }

    function totalPaidBGN(paidBGN, paidEUR){
      const bgn = Number.isFinite(paidBGN) ? paidBGN : 0;
      const eur = Number.isFinite(paidEUR) ? paidEUR : 0;
      return bgn + eur * RATE;
    }

    function calculate(){
      clearWarn();

      const billVal = parseNumber(billEl.value);
      const paidValBGN = parseNumber(paidEl.value);
      const paidValEUR = parseNumber(paidEurEl.value);

      // позволяваме единият да е празен, но не и двата невалидни
      const paidBGN_ok = Number.isFinite(paidValBGN);
      const paidEUR_ok = Number.isFinite(paidValEUR);

      if (!Number.isFinite(billVal) || (!paidBGN_ok && !paidEUR_ok)) {
        eurEl.textContent = "0.00";
        bgnEl.textContent = "0.00";
        setWarn("Въведи валидни числа (можеш и със запетая).");
        return;
      }

      const billBGN = billToBGN(billVal);
      if (!Number.isFinite(billBGN)) {
        eurEl.textContent = "0.00";
        bgnEl.textContent = "0.00";
        setWarn("Грешка при смятане на сметката. Провери стойността.");
        return;
      }

      const paidTotal = totalPaidBGN(paidValBGN, paidValEUR);

      // в стотинки (точност)
      const changeSt = Math.round((paidTotal - billBGN) * 100);

      if (changeSt < 0) {
        eurEl.textContent = "0.00";
        bgnEl.textContent = "0.00";
        setWarn(`Недостатъчна сума: липсват ${(Math.abs(changeSt)/100).toFixed(2)} лв.`);
        return;
      }

      const changeBGN = changeSt / 100;

      // EUR: закръглено до 0.01 EUR
      const eurRounded = Math.round((changeBGN / RATE) * 100) / 100;

      eurEl.textContent = eurRounded.toFixed(2);
      bgnEl.textContent = changeBGN.toFixed(2);

      const billLabel = billCurrency === "BGN"
        ? `${billVal.toFixed(2)} лв`
        : `${billVal.toFixed(2)} EUR`;

      const paidBGNText = (Number.isFinite(paidValBGN) ? paidValBGN : 0).toFixed(2);
      const paidEURText = (Number.isFinite(paidValEUR) ? paidValEUR : 0).toFixed(2);

      infoEl.textContent =
        `Сметка: ${billLabel} → платено: ${paidBGNText} лв + ${paidEURText} EUR `
        + `= ${paidTotal.toFixed(2)} лв → ресто: ${changeBGN.toFixed(2)} лв `
        + `(${eurRounded.toFixed(2)} EUR по курс, закръглено).`;
    }

    function addPickedSt(st, label){
      picked.push({ st, label });
      updatePickedUIAndPaid();
      calculate();
      paidEl.focus();
    }

    function undoLast(){
      if (!picked.length) return;
      picked.pop();
      updatePickedUIAndPaid();
      calculate();
      paidEl.focus();
    }

    function clearPaid(){
      picked.length = 0;
      paidEl.value = '';
      paidEurEl.value = '';
      pickedListEl.textContent = "—";
      calculate();
      paidEl.focus();
    }

    function clearBill(){
      billEl.value = '';
      calculate();
      billEl.focus();
    }

    function setBillCurrency(next){
      billCurrency = next;
      billBGNBtn.classList.toggle('active', next === "BGN");
      billEURBtn.classList.toggle('active', next === "EUR");
      billHint.textContent = next === "BGN" ? "Сметката е в лева (BGN)." : "Сметката е в евро (EUR).";
      calculate();
      billEl.focus();
    }

    function setBanknotesVisible(visible){
      banknotesSection.hidden = !visible;
    }

    // ---- Events ----
    billEURBtn.addEventListener('click', () => setBillCurrency("EUR"));
    billBGNBtn.addEventListener('click', () => setBillCurrency("BGN"));

    setBanknotesVisible(false);
    showBanknotesSwitch.addEventListener('change', () => {
      setBanknotesVisible(showBanknotesSwitch.checked);
    });

    banknotesWrap.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-value-st]');
      if (!btn) return;

      const st = Number(btn.getAttribute('data-value-st'));
      const label = btn.getAttribute('data-label') || String(st/100);

      if (Number.isFinite(st)) addPickedSt(st, label);
    });

    // ако редактираш ръчно BGN или EUR — изчистваме “натиснати” банкноти (за да няма смесване)
    function clearPickedIfManualEdit(targetEl){
      if (document.activeElement === targetEl) {
        picked.length = 0;
        pickedListEl.textContent = "—";
      }
    }

    paidEl.addEventListener('input', () => {
      clearPickedIfManualEdit(paidEl);
      calculate();
    });

    paidEurEl.addEventListener('input', () => {
      // EUR не идва от банкноти, но пак чистим picked за консистентност
      clearPickedIfManualEdit(paidEurEl);
      calculate();
    });

    billEl.addEventListener('input', calculate);

    calcBtn.addEventListener('click', calculate);
    if (undoBtn) undoBtn.addEventListener('click', undoLast);
    clearPaidBtn.addEventListener('click', clearPaid);
    clearBillBtn.addEventListener('click', clearBill);

    clearAllBtn.addEventListener('click', () => {
      billEl.value = '';
      picked.length = 0;
      paidEl.value = '';
      paidEurEl.value = '';
      pickedListEl.textContent = "—";
      eurEl.textContent = "0.00";
      bgnEl.textContent = "0.00";
      infoEl.textContent = '';
      clearWarn();
      billEl.focus();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') calculate();
    });

    // Инициализация
    setBillCurrency("EUR");
  </script>
</body>
</html>
